# FDCR 无攻击场景实验说明

## 实验目的

在**0%恶意客户端**（无攻击）的场景下，测试去作弊版FDCR的误报率（FPR）和过滤比例，以验证：

1. **FINCH+Fisher在异构/Non-IID场景下是否存在天然不稳定性**
2. **即使没有攻击，去作弊版是否仍会产生高误报**
3. **数据异构性（α值）对误报的影响**

## 实验设计

### 实验配置

| 配置项 | 值 |
|--------|-----|
| 攻击类型 | backdoor (但恶意率=0%) |
| 恶意客户端比例 | 0% (无攻击) |
| 数据分布 | α=0.9 (接近IID), α=0.1 (高度异构) |
| 服务器版本 | OurRandomControlNoCheat (去作弊版) |
| 总实验数 | 2个 |

### 关键指标

1. **FPR (False Positive Rate)**: 误报率
   - 在无攻击场景下，所有被标记为恶意的客户端都是误报
   - FPR = FP / (TN + FP)
   - 理想情况下应该为0%

2. **平均过滤比例**: 每轮被过滤的客户端占总客户端的比例
   - 理想情况下应该为0%

3. **误报发生率**: 产生误报的轮次占总轮次的比例

4. **平均/最大误报数**: 每轮平均/最多误报多少个客户端

## 运行步骤

### 1. 本地运行实验

```bash
# 激活环境
conda activate backfed

# 运行实验（约2-3小时）
python run_no_attack_experiment.py
```

### 2. 服务器运行实验

```bash
# 连接服务器
ssh your_server

# 进入项目目录
cd ~/FDCR-reproduction

# 激活环境
conda activate backfed_env

# 使用screen后台运行
screen -S no_attack_exp
python run_no_attack_experiment.py

# 按 Ctrl+A+D 退出screen
# 查看进度: screen -r no_attack_exp
```

### 3. 分析结果

实验完成后运行分析脚本：

```bash
python analyze_no_attack.py
```

## 预期结果

### 假设1: 高度异构场景下误报率更高

如果 α=0.1 (高度异构) 的FPR显著高于 α=0.9 (接近IID)，说明：
- FINCH+Fisher在Non-IID场景下天然不稳定
- 数据异构性会导致良性客户端的Fisher信息差异增大
- 聚类算法容易将异构的良性客户端误判为恶意

### 假设2: 即使无攻击也会产生误报

如果在0%恶意的场景下仍然有较高的FPR（如>10%），说明：
- 去作弊版的检测机制存在根本性问题
- Fisher信息本身不足以区分客户端
- 之前的高检测率确实来自"作弊"路径

### 假设3: 误报会影响模型性能

如果误报导致大量良性客户端被过滤，可能会：
- 降低模型的收敛速度
- 影响最终的准确率
- 在高度异构场景下尤其明显

## 与之前实验的对比

| 场景 | 恶意率 | 作弊版TPR | 去作弊版TPR | 去作弊版FPR |
|------|--------|-----------|-------------|-------------|
| base_backdoor (α=0.9) | 30% | 99.7% | 21.0% | 36.7% |
| base_backdoor (α=0.1) | 30% | 99.3% | 8.0% | 46.0% |
| **无攻击 (α=0.9)** | **0%** | N/A | N/A | **?** |
| **无攻击 (α=0.1)** | **0%** | N/A | N/A | **?** |

在有攻击的场景下，去作弊版已经表现出高FPR（36.7%-46.0%）。
在无攻击场景下，如果FPR仍然很高，将进一步证明这是方法本身的问题。

## 实验意义

这个实验将形成完整的证据链：

```
1. 作弊版在有攻击时表现优异 (TPR 99.6%)
   ↓
2. 去作弊版在有攻击时表现很差 (TPR 21.3%, FPR 38.5%)
   ↓
3. 去作弊版在无攻击时仍有高FPR (本实验)
   ↓
结论: FDCR的检测能力完全来自"作弊"路径
      Fisher信息+FINCH聚类在Non-IID下天然不稳定
```

## 输出文件

实验结果将保存在：
```
data/label_skew/backdoor/0.0/fl_cifar10/
├── 0.9/OurRandomControlNoCheat/FedFish/no_attack_alpha0.9_OurRandomControlNoCheat_seed0/
│   ├── detection_results.csv
│   ├── test_acc.csv
│   └── cfg.yaml
└── 0.1/OurRandomControlNoCheat/FedFish/no_attack_alpha0.1_OurRandomControlNoCheat_seed0/
    ├── detection_results.csv
    ├── test_acc.csv
    └── cfg.yaml
```

## 后续工作

完成本实验后，可以：
1. 更新实验报告，添加无攻击场景的分析
2. 制作对比图表，展示不同场景下的FPR
3. 撰写论文，质疑FDCR的有效性
4. 探索改进方案（如结合其他特征）
